using System;
using System.Collections.Generic;
using System.Linq;
using System.Text.RegularExpressions;

class FileName
{
    public string BaseName { get; }
    public int Version { get; }
    public string FullName => Version > 0 ? $"{BaseName}(v{Version})" : BaseName;

    private static readonly Regex VersionRegex = new Regex(@"^(.*?)(?:\(v(\d+)\))?$", RegexOptions.IgnoreCase);

    public FileName(string name)
    {
        var match = VersionRegex.Match(name.Trim());
        if (!match.Success)
            throw new ArgumentException($"Invalid file name format: {name}");

        BaseName = match.Groups[1].Value;
        Version = match.Groups[2].Success ? int.Parse(match.Groups[2].Value) : 0;
    }
}

class FileNameManager
{
    private HashSet<string> existing; // case-insensitive
    private Dictionary<string, int> highestVersion; // key = lowercase basename

    public FileNameManager(IEnumerable<string> initialNames)
    {
        existing = new HashSet<string>(StringComparer.OrdinalIgnoreCase);
        highestVersion = new Dictionary<string, int>(StringComparer.OrdinalIgnoreCase);

        foreach (var name in initialNames)
        {
            AddExisting(name);
        }
    }

    private void AddExisting(string name)
    {
        var fn = new FileName(name);
        existing.Add(fn.FullName);
        if (!highestVersion.ContainsKey(fn.BaseName))
            highestVersion[fn.BaseName] = fn.Version;
        else
            highestVersion[fn.BaseName] = Math.Max(highestVersion[fn.BaseName], fn.Version);
    }

    public string AssignUnique(string incoming)
    {
        var fn = new FileName(incoming);

        if (!existing.Contains(fn.FullName))
        {
            AddExisting(fn.FullName);
            return fn.FullName;
        }

        // Need to increment version
        if (!highestVersion.ContainsKey(fn.BaseName))
            highestVersion[fn.BaseName] = 0;

        int newVersion = highestVersion[fn.BaseName] + 1;
        string newName;
        do
        {
            newName = $"{fn.BaseName}(v{newVersion})";
            newVersion++;
        } while (existing.Contains(newName));

        // Store and update highest version
        var finalName = newName;
        AddExisting(finalName);
        return finalName;
    }
}

class Program
{
    static void Main()
    {
        var originalNames = new List<string>
        {
            "Report", "Report(v1)", "Summary", "data", "Data(v2)"
        };

        var newNames = new List<string>
        {
            "Report", "Summary", "Data", "NewFile", "report"
        };

        var manager = new FileNameManager(originalNames);
        var finalList = new List<string>();

        foreach (var name in newNames)
        {
            string uniqueName = manager.AssignUnique(name);
            finalList.Add(uniqueName);
        }

        Console.WriteLine("Final Unique Names:");
        foreach (var name in finalList)
        {
            Console.WriteLine(name);
        }
    }
}
